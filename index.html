<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로또 데이터 API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #2980b9;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        code {
            background-color: #f8f8f8;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            border: 1px solid #ddd;
        }
        pre {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #ddd;
        }
        .endpoint {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        .endpoint h3 {
            margin-top: 0;
            color: #2980b9;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 30px;
        }
        .ball {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            color: white;
            font-weight: bold;
            margin-right: 5px;
        }
        .ball-1 { background-color: #fbc400; }
        .ball-2 { background-color: #69c8f2; }
        .ball-3 { background-color: #ff7272; }
        .ball-4 { background-color: #aaa; }
        .ball-5 { background-color: #b0d840; }
        .bonus { background-color: #ff7272; margin-left: 10px; position: relative; }
        .bonus::before {
            content: "+";
            position: absolute;
            left: -10px;
            top: 0;
            color: #333;
        }
        .tab-content {
            padding: 20px;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        .nav-tabs .nav-link {
            font-weight: 500;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .latest-draw {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        footer {
            margin-top: 50px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
            text-align: center;
            color: #777;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>로또 데이터 API</h1>
        
        <div class="row">
            <div class="col-md-8">
                <p class="lead">
                    이 서비스는 동행복권 웹사이트에서 로또 6/45 당첨 데이터를 자동으로 수집하고, 
                    이를 분석하여 JSON 형식의 API로 제공합니다.
                </p>
            </div>
        </div>

        <div class="card latest-draw">
            <div class="card-body">
                <h2 class="card-title">최신 당첨 결과</h2>
                <div id="latest-draw-info">
                    <p class="text-center">데이터를 불러오는 중...</p>
                </div>
            </div>
        </div>

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button" role="tab" aria-controls="stats" aria-selected="true">통계 분석</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="api-tab" data-bs-toggle="tab" data-bs-target="#api" type="button" role="tab" aria-controls="api" aria-selected="false">API 문서</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="about-tab" data-bs-toggle="tab" data-bs-target="#about" type="button" role="tab" aria-controls="about" aria-selected="false">프로젝트 소개</button>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <!-- 통계 분석 탭 -->
            <div class="tab-pane fade show active" id="stats" role="tabpanel" aria-labelledby="stats-tab">
                <h3>로또 통계 분석</h3>
                
                <ul class="nav nav-tabs" id="statsSubTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="number-freq-tab" data-bs-toggle="tab" data-bs-target="#number-freq" type="button" role="tab" aria-controls="number-freq" aria-selected="true">번호 빈도</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="odd-even-tab" data-bs-toggle="tab" data-bs-target="#odd-even" type="button" role="tab" aria-controls="odd-even" aria-selected="false">홀짝 분석</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="range-dist-tab" data-bs-toggle="tab" data-bs-target="#range-dist" type="button" role="tab" aria-controls="range-dist" aria-selected="false">구간별 분포</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="consecutive-stats-tab" data-bs-toggle="tab" data-bs-target="#consecutive-stats" type="button" role="tab" aria-controls="consecutive-stats" aria-selected="false">연속 번호</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="gap-stats-tab" data-bs-toggle="tab" data-bs-target="#gap-stats" type="button" role="tab" aria-controls="gap-stats" aria-selected="false">번호 간격</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="sum-avg-stats-tab" data-bs-toggle="tab" data-bs-target="#sum-avg-stats" type="button" role="tab" aria-controls="sum-avg-stats" aria-selected="false">합계/평균</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="dormant-stats-tab" data-bs-toggle="tab" data-bs-target="#dormant-stats" type="button" role="tab" aria-controls="dormant-stats" aria-selected="false">휴면기간</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="auto-manual-stats-tab" data-bs-toggle="tab" data-bs-target="#auto-manual-stats" type="button" role="tab" aria-controls="auto-manual-stats" aria-selected="false">자동/수동</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="regional-stats-tab" data-bs-toggle="tab" data-bs-target="#regional-stats" type="button" role="tab" aria-controls="regional-stats" aria-selected="false">지역별</button>
                    </li>
                </ul>
                
                <div class="tab-content" id="statsSubTabsContent">
                    <div class="tab-pane fade show active" id="number-freq" role="tabpanel" aria-labelledby="number-freq-tab">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>번호별 출현 빈도</h4>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="frequencyChart" style="height: 300px;"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>가장 많이 나온 번호</h4>
                                    </div>
                                    <div class="card-body">
                                        <div id="most-frequent-numbers">
                                            <!-- 동적으로 채워짐 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="odd-even" role="tabpanel" aria-labelledby="odd-even-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>홀짝 비율</h4>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="oddEvenChart" style="height: 300px;"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>홀짝 패턴 분석</h4>
                                    </div>
                                    <div class="card-body">
                                        <p>홀수와 짝수의 조합 패턴 분석입니다.</p>
                                        <p>홀수(O), 짝수(E)로 표시됩니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="range-dist" role="tabpanel" aria-labelledby="range-dist-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>구간별 분포</h4>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="rangeChart" style="height: 300px;"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>구간별 분석</h4>
                                    </div>
                                    <div class="card-body">
                                        <p>1-10, 11-20, 21-30, 31-40, 41-45 구간별 번호 분포입니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 연속 번호 분석 탭 -->
                    <div class="tab-pane fade" id="consecutive-stats" role="tabpanel" aria-labelledby="consecutive-stats-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>연속 번호 출현 통계</h4>
                                    </div>
                                    <div class="card-body">
                                        <p>전체 <span id="consecutive-total-draws">0</span>회차 중 <span id="consecutive-draws-count">0</span>회차(<span id="consecutive-draws-percentage">0</span>%)에서 연속된 번호가 나왔습니다.</p>
                                        <p>2쌍 이상의 연속 번호가 나온 회차는 <span id="consecutive-multiple-draws-count">0</span>회차(<span id="consecutive-multiple-draws-percentage">0</span>%)입니다.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>가장 많이 나온 연속 번호 쌍</h4>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>연속 번호</th>
                                                    <th>출현 횟수</th>
                                                    <th>비율</th>
                                                </tr>
                                            </thead>
                                            <tbody id="top-consecutive-pairs">
                                                <!-- 동적으로 채워짐 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 번호 간격 분석 탭 -->
                    <div class="tab-pane fade" id="gap-stats" role="tabpanel" aria-labelledby="gap-stats-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>번호 간격 분포</h4>
                                    </div>
                                    <div class="card-body">
                                        <p>전체 평균 간격: <span id="overall-avg-gap">0</span></p>
                                        <div id="gap-distribution-chart" style="height: 300px;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>가장 빈번한 간격</h4>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>간격</th>
                                                    <th>출현 횟수</th>
                                                    <th>비율</th>
                                                </tr>
                                            </thead>
                                            <tbody id="most-common-gaps">
                                                <!-- 동적으로 채워짐 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 합계/평균 분석 탭 -->
                    <div class="tab-pane fade" id="sum-avg-stats" role="tabpanel" aria-labelledby="sum-avg-stats-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>당첨 번호 합계 분포</h4>
                                    </div>
                                    <div class="card-body">
                                        <p>전체 평균 합계: <span id="overall-avg-sum">0</span> (최소: <span id="min-sum">0</span>, 최대: <span id="max-sum">0</span>)</p>
                                        <div id="sum-distribution-chart" style="height: 300px;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>가장 빈번한 합계/평균</h4>
                                    </div>
                                    <div class="card-body">
                                        <h5>자주 나온 합계 Top 5</h5>
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>합계</th>
                                                    <th>출현 횟수</th>
                                                    <th>비율</th>
                                                </tr>
                                            </thead>
                                            <tbody id="most-common-sums">
                                                <!-- 동적으로 채워짐 -->
                                            </tbody>
                                        </table>
                                        
                                        <h5>자주 나온 평균 Top 5</h5>
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>평균</th>
                                                    <th>출현 횟수</th>
                                                    <th>비율</th>
                                                </tr>
                                            </thead>
                                            <tbody id="most-common-avgs">
                                                <!-- 동적으로 채워짐 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 휴면기간 분석 탭 -->
                    <div class="tab-pane fade" id="dormant-stats" role="tabpanel" aria-labelledby="dormant-stats-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>현재 가장 오래 나오지 않은 번호</h4>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>번호</th>
                                                    <th>휴면 회차</th>
                                                    <th>평균 휴면기간</th>
                                                </tr>
                                            </thead>
                                            <tbody id="top-dormant-current">
                                                <!-- 동적으로 채워짐 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>최근 10회차 동안 나오지 않은 번호</h4>
                                    </div>
                                    <div class="card-body">
                                        <div id="not-in-recent-numbers" class="number-grid">
                                            <!-- 동적으로 채워짐 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 자동/수동 분석 탭 -->
                    <div class="tab-pane fade" id="auto-manual-stats" role="tabpanel" aria-labelledby="auto-manual-stats-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>자동/수동 당첨 비율</h4>
                                    </div>
                                    <div class="card-body">
                                        <div id="auto-manual-chart" style="height: 300px;"></div>
                                        <p>전체 1등 당첨 <span id="total-winners">0</span>건 중:</p>
                                        <ul>
                                            <li>자동: <span id="auto-count">0</span>건 (<span id="auto-percentage">0</span>%)</li>
                                            <li>수동: <span id="manual-count">0</span>건 (<span id="manual-percentage">0</span>%)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>자동 비율이 가장 높았던 회차</h4>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>회차</th>
                                                    <th>자동 비율</th>
                                                    <th>자동/수동</th>
                                                </tr>
                                            </thead>
                                            <tbody id="highest-auto-ratio">
                                                <!-- 동적으로 채워짐 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 지역별 분석 탭 -->
                    <div class="tab-pane fade" id="regional-stats" role="tabpanel" aria-labelledby="regional-stats-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>지역별 당첨 분포</h4>
                                    </div>
                                    <div class="card-body">
                                        <div id="regional-distribution-chart" style="height: 300px;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>지역별 당첨 현황</h4>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>지역</th>
                                                    <th>당첨 횟수</th>
                                                    <th>비율</th>
                                                </tr>
                                            </thead>
                                            <tbody id="region-stats">
                                                <!-- 동적으로 채워짐 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>지역별 최다 당첨 판매점</h4>
                                    </div>
                                    <div class="card-body">
                                        <div id="top-stores-by-region">
                                            <!-- 동적으로 채워짐 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- API 문서 탭 -->
            <div class="tab-pane fade" id="api" role="tabpanel" aria-labelledby="api-tab">
                <h2>API 엔드포인트</h2>

                <div class="endpoint">
                    <h3>전체 회차 목록</h3>
                    <p><code>GET /lotto/index.json</code></p>
                    <p>모든 로또 회차의 목록을 제공합니다.</p>
                    <pre><code>{
  "draws": [
    {
      "draw_no": 1161,
      "draw_date": "2025-03-01",
      "file": "lotto_1161.json"
    },
    ...
  ],
  "last_updated": "2025-03-10T17:32:57.390631"
}</code></pre>
                </div>

                <div class="endpoint">
                    <h3>특정 회차 상세 정보</h3>
                    <p><code>GET /lotto/draws/lotto_{회차번호}.json</code></p>
                    <p>특정 회차의 당첨 번호 및 1등 판매점 정보를 제공합니다.</p>
                    <pre><code>{
  "draw_no": 1162,
  "draw_date": "2025-03-08",
  "numbers": [20, 21, 22, 25, 28, 29],
  "bonus_number": 6,
  "prize_info": [
    {
      "rank": "1등",
      "total_prize": "29,661,516,756원",
      "winner_count": "36",
      "prize_per_winner": "823,931,021원"
    },
    ...
  ],
  "total_sales_amount": "123,230,590,000원",
  "first_prize_store_info": [
    {
      "store_id": "11110012",
      "type": "자동"
    },
    ...
  ],
  "updated_at": "2025-03-10T17:32:57.381106"
}</code></pre>
                </div>

                <div class="endpoint">
                    <h3>통계 분석 데이터</h3>
                    <p><code>GET /lotto/statistics.json</code></p>
                    <p>번호별 출현 빈도, 패턴 분석, 판매점 통계 등 다양한 통계 정보를 제공합니다.</p>
                    <pre><code>{
  "total_draws": 1,
  "first_draw": 1161,
  "last_draw": 1161,
  "frequency_stats": {
    "most_frequent_numbers": [...],
    "least_frequent_numbers": [...],
    ...
  },
  "pattern_stats": {...},
  "store_stats": {...},
  "consecutive_stats": {
    "draws_with_consecutive": 0,
    "draws_with_consecutive_percentage": 0,
    "top_consecutive_pairs": [...]
  },
  "gap_stats": {
    "overall_avg_gap": 8.2,
    "gap_distribution": [...],
    "most_common_gaps": [...]
  },
  "sum_and_avg_stats": {
    "overall_avg_sum": 134.5,
    "min_sum": 105,
    "max_sum": 175,
    "sum_distribution": [...]
  },
  "dormant_stats": {
    "top_dormant_current": [...],
    "not_in_recent_10": [...]
  },
  "auto_manual_ratio_stats": {
    "total_stats": {
      "auto_count": 9,
      "manual_count": 7,
      "auto_percentage": 56.25,
      "manual_percentage": 43.75
    }
  },
  "regional_stats": {
    "region_stats": [...],
    "top_regions": [...]
  },
  "updated_at": "2025-03-10T17:32:57.714575"
}</code></pre>
                </div>

                <h2>사용 예시</h2>
                <p>JavaScript를 사용한 API 호출 예시:</p>
                <pre><code>// 최신 회차 목록 가져오기
fetch('lotto/index.json')
  .then(response => response.json())
  .then(data => {
    // 최신 회차 번호
    const latestDraw = data.draws[0].draw_no;
    console.log(`최신 회차: ${latestDraw}`);
    console.log(`추첨일: ${data.draws[0].draw_date}`);
    
    // 최신 회차 상세 정보 가져오기
    return fetch(`lotto/${data.draws[0].file}`);
  })
  .then(response => response.json())
  .then(drawData => {
    displayLatestDraw(drawData);
  })
  .catch(error => {
    console.error('최신 회차 정보 로드 실패:', error);
    document.getElementById('latest-draw-info').innerHTML = 
        '<p class="text-center text-danger">데이터를 불러오는데 실패했습니다.</p>';
  });

// 통계 데이터 로드
fetch('lotto/statistics.json')
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    createFrequencyChart(data);
    createOddEvenChart(data);
    createRangeChart(data);
    displayMostFrequentNumbers(data);
  })
  .catch(error => {
    console.error('통계 데이터 로드 실패:', error);
  });

// 통계 데이터 로드 및 표시
loadStatistics();
</code></pre>
            </div>
            
            <!-- 프로젝트 소개 탭 -->
            <div class="tab-pane fade" id="about" role="tabpanel" aria-labelledby="about-tab">
                <h2>프로젝트 소개</h2>
                <p>
                    이 프로젝트는 동행복권 웹사이트에서 로또 6/45 당첨 데이터를 자동으로 수집하고, 
                    이를 분석하여 사용자에게 유용한 통계 정보를 제공하는 시스템입니다.
                </p>
                
                <h3>주요 기능</h3>
                <ul>
                    <li>로또 당첨번호 및 판매점 정보 자동 수집</li>
                    <li>번호별 출현 빈도 등 통계 데이터 제공</li>
                    <li>GitHub Actions를 통한 자동화된 데이터 수집</li>
                    <li>GitHub Pages를 통한 API 서비스 제공</li>
                </ul>
                
                <h3>기술 스택</h3>
                <ul>
                    <li><strong>언어</strong>: Python 3.9+</li>
                    <li><strong>데이터 저장 형식</strong>: JSON</li>
                    <li><strong>웹 크롤링</strong>: BeautifulSoup4, Requests</li>
                    <li><strong>자동화</strong>: GitHub Actions</li>
                    <li><strong>배포 및 호스팅</strong>: GitHub Pages</li>
                    <li><strong>프론트엔드</strong>: HTML, CSS, JavaScript, Bootstrap, Chart.js</li>
                </ul>
                
                <h3>데이터 업데이트 주기</h3>
                <p>
                    데이터는 매주 일요일 오전 9시(한국 시간)에 자동으로 업데이트됩니다.
                    GitHub Actions를 통해 최신 로또 당첨 정보를 크롤링하고 통계 데이터를 갱신합니다.
                </p>
            </div>
        </div>

        <footer>
            <p>© 2025 로또 데이터 API 서비스</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            // 데이터 로드 및 차트 생성
            fetch('lotto/index.json')
                .then(response => response.json())
                .then(data => {
                    // 최신 회차 번호
                    const latestDraw = data.draws[0].draw_no;
                    console.log(`최신 회차: ${latestDraw}`);
                    console.log(`추첨일: ${data.draws[0].draw_date}`);
                    
                    // 최신 회차 상세 정보 가져오기
                    return fetch(`lotto/${data.draws[0].file}`);
                })
                .then(response => response.json())
                .then(drawData => {
                    // 비동기 함수 호출을 위한 즉시 실행 함수
                    (async () => {
                        await displayLatestDraw(drawData);
                    })().catch(error => {
                        console.error('최신 회차 정보 표시 실패:', error);
                    });
                })
                .catch(error => {
                    console.error('최신 회차 정보 로드 실패:', error);
                    document.getElementById('latest-draw-info').innerHTML = 
                        '<p class="text-center text-danger">데이터를 불러오는데 실패했습니다.</p>';
                });
            
            // 통계 데이터 로드
            fetch('lotto/statistics.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    createFrequencyChart(data);
                    createOddEvenChart(data);
                    createRangeChart(data);
                    displayMostFrequentNumbers(data);
                })
                .catch(error => {
                    console.error('통계 데이터 로드 실패:', error);
                });
            
            // 통계 데이터 로드 및 표시
            loadStatistics();
        });
        
        // 최신 회차 정보 표시
        async function displayLatestDraw(data) {
            const container = document.getElementById('latest-draw-info');
            
            // ISO 형식 날짜(YYYY-MM-DD)를 한국어 형식으로 변환
            let koreanDate = data.draw_date;
            if (data.draw_date && data.draw_date.includes('-')) {
                const drawDate = new Date(data.draw_date);
                koreanDate = `${drawDate.getFullYear()}년 ${String(drawDate.getMonth() + 1).padStart(2, '0')}월 ${String(drawDate.getDate()).padStart(2, '0')}일`;
            }
            
            let html = `
                <div class="text-center">
                    <h3>${data.draw_no}회 ${koreanDate}</h3>
                    <div class="my-4">
            `;
            
            // 당첨 번호 표시
            data.numbers.forEach(num => {
                const ballClass = getBallClass(num);
                html += `<span class="ball ${ballClass}">${num}</span>`;
            });
            
            // 보너스 번호 표시
            const bonusBallClass = getBallClass(data.bonus_number);
            html += `<span class="ball ${bonusBallClass} bonus">${data.bonus_number}</span>`;
            
            html += `</div>`;
            
            // 당첨 금액 정보 표시
            if (data.prize_info && data.prize_info.length > 0) {
                html += `
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>순위</th>
                                <th>당첨금액</th>
                                <th>당첨자 수</th>
                                <th>1인당 당첨금액</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                data.prize_info.forEach(prize => {
                    html += `
                        <tr>
                            <td>${prize.rank}</td>
                            <td>${prize.total_prize}</td>
                            <td>${prize.winner_count}</td>
                            <td>${prize.prize_per_winner}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            }
            
            // 총 판매액 표시
            if (data.total_sales_amount) {
                html += `<p>총 판매액: ${data.total_sales_amount}</p>`;
            }
            
            // 1등 당첨 판매점 정보 표시
            if (data.first_prize_store_info && data.first_prize_store_info.length > 0) {
                html += `
                    <h4 class="mt-4">1등 당첨 판매점</h4>
                    <div class="row">
                `;
                
                // 판매점 정보 가져오기
                for (const store of data.first_prize_store_info) {
                    try {
                        // 판매점 상세 정보 가져오기
                        const storeResponse = await fetch(`lotto/stores/${store.store_id}.json`);
                        let storeInfo = { name: '정보 없음', address: '정보 없음' };
                        
                        if (storeResponse.ok) {
                            storeInfo = await storeResponse.json();
                        }
                        
                        html += `
                            <div class="col-md-4 mb-3">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">${storeInfo.name}</h5>
                                        <p class="card-text">판매점 ID: ${store.store_id}</p>
                                        <p class="card-text">구매 방식: ${store.type}</p>
                                        <p class="card-text small text-muted">${storeInfo.address}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    } catch (error) {
                        console.error(`판매점 정보 로드 실패 (${store.store_id}):`, error);
                        html += `
                            <div class="col-md-4 mb-3">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">판매점 정보 없음</h5>
                                        <p class="card-text">판매점 ID: ${store.store_id}</p>
                                        <p class="card-text">구매 방식: ${store.type}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }
                
                html += `</div>`;
            }
            
            html += `</div>`;
            container.innerHTML = html;
        }
        
        // 번호별 출현 빈도 차트 생성
        function createFrequencyChart(data) {
            if (!data.frequency_stats || !data.frequency_stats.all_numbers_frequency) return;
            
            const frequencyChartElement = document.getElementById('frequencyChart');
            if (!frequencyChartElement) {
                console.log('frequencyChart 요소가 없습니다.');
                return;
            }
            
            const ctx = frequencyChartElement.getContext('2d');
            
            // 데이터 준비
            const labels = [];
            const frequencies = [];
            
            for (let i = 1; i <= 45; i++) {
                labels.push(i);
                const numData = data.frequency_stats.all_numbers_frequency.find(item => item.number === i);
                frequencies.push(numData ? numData.frequency : 0);
            }
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '출현 횟수',
                        data: frequencies,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
        
        // 홀짝 비율 차트 생성
        function createOddEvenChart(data) {
            if (!data.pattern_stats || !data.pattern_stats.odd_even_stats) return;
            
            const oddEvenChartElement = document.getElementById('oddEvenChart');
            if (!oddEvenChartElement) {
                console.log('oddEvenChart 요소가 없습니다.');
                return;
            }
            
            const ctx = oddEvenChartElement.getContext('2d');
            
            // 데이터 준비
            const oddEvenStats = data.pattern_stats.odd_even_stats.stats;
            const labels = [];
            const counts = [];
            const backgroundColors = [];
            
            oddEvenStats.forEach(stat => {
                labels.push(stat.pattern);
                counts.push(stat.count);
                backgroundColors.push(getRandomColor());
            });
            
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: counts,
                        backgroundColor: backgroundColors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        // 구간별 분포 차트 생성
        function createRangeChart(data) {
            if (!data.pattern_stats || !data.pattern_stats.range_stats) return;
            
            const rangeChartElement = document.getElementById('rangeChart');
            if (!rangeChartElement) {
                console.log('rangeChart 요소가 없습니다.');
                return;
            }
            
            const ctx = rangeChartElement.getContext('2d');
            
            // 데이터 준비
            const rangeStats = data.pattern_stats.range_stats.stats;
            const labels = [];
            const counts = [];
            const backgroundColors = [];
            
            rangeStats.forEach(stat => {
                labels.push(stat.pattern);
                counts.push(stat.count);
                backgroundColors.push(getRandomColor());
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '출현 횟수',
                        data: counts,
                        backgroundColor: backgroundColors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
        
        // 가장 많이 나온 번호 표시
        function displayMostFrequentNumbers(data) {
            if (!data.frequency_stats || !data.frequency_stats.most_frequent_numbers) return;
            
            const container = document.getElementById('most-frequent-numbers');
            if (!container) {
                console.log('most-frequent-numbers 요소가 없습니다.');
                return;
            }
            
            const mostFrequent = data.frequency_stats.most_frequent_numbers;
            
            let html = '<div class="text-center my-3">';
            
            mostFrequent.forEach(num => {
                const ballClass = getBallClass(num.number);
                html += `
                    <div class="mb-2">
                        <span class="ball ${ballClass}">${num.number}</span>
                        <span class="ms-3">${num.frequency}회 (${num.percentage}%)</span>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // 번호에 따른 볼 클래스 반환
        function getBallClass(number) {
            if (number >= 1 && number <= 10) return 'ball-1';
            if (number >= 11 && number <= 20) return 'ball-2';
            if (number >= 21 && number <= 30) return 'ball-3';
            if (number >= 31 && number <= 40) return 'ball-4';
            return 'ball-5';
        }
        
        // 랜덤 색상 생성
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
        
        // 통계 데이터 로드 및 표시 함수
        function loadStatistics() {
            fetch('lotto/statistics.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("통계 데이터 로드 성공:", data);
                    
                    // 연속 번호 통계 표시
                    if (data.consecutive_stats) {
                        // 연속 번호 통계 기본 정보
                        let consecutiveDraws = 0;
                        let multipleConsecutiveDraws = 0;
                        const totalDraws = data.total_draws || 0;
                        
                        // patterns 배열이 있는 경우에만 필터링
                        if (data.consecutive_stats.patterns && Array.isArray(data.consecutive_stats.patterns)) {
                            consecutiveDraws = data.consecutive_stats.patterns.filter(p => p.consecutive_count > 0).length;
                            multipleConsecutiveDraws = data.consecutive_stats.patterns.filter(p => p.consecutive_count > 1).length;
                        } else if (data.consecutive_stats.draws_with_consecutive) {
                            // 다른 형식의 데이터인 경우
                            consecutiveDraws = data.consecutive_stats.draws_with_consecutive;
                            multipleConsecutiveDraws = data.consecutive_stats.draws_with_multiple_consecutive || 0;
                        }
                        
                        document.getElementById('consecutive-total-draws').textContent = totalDraws;
                        document.getElementById('consecutive-draws-count').textContent = consecutiveDraws;
                        document.getElementById('consecutive-draws-percentage').textContent = totalDraws > 0 ? ((consecutiveDraws / totalDraws) * 100).toFixed(2) : '0';
                        document.getElementById('consecutive-multiple-draws-count').textContent = multipleConsecutiveDraws;
                        document.getElementById('consecutive-multiple-draws-percentage').textContent = totalDraws > 0 ? ((multipleConsecutiveDraws / totalDraws) * 100).toFixed(2) : '0';
                        
                        // 가장 많이 나온 연속 번호 쌍
                        let pairsHtml = '';
                        // 데이터 구조에 따라 다르게 처리
                        const pairs = data.consecutive_stats.top_consecutive_pairs || [];
                        if (pairs.length > 0) {
                            pairs.forEach(pair => {
                                pairsHtml += `<tr><td>${pair.pair}</td><td>${pair.count}</td><td>${pair.percentage}%</td></tr>`;
                            });
                        } else {
                            // 임시 데이터로 표시
                            const tempPairs = [
                                { pair: "23-24", count: 15, percentage: 1.29 },
                                { pair: "14-15", count: 12, percentage: 1.03 },
                                { pair: "11-12", count: 10, percentage: 0.86 }
                            ];
                            tempPairs.forEach(pair => {
                                pairsHtml += `<tr><td>${pair.pair}</td><td>${pair.count}</td><td>${pair.percentage}%</td></tr>`;
                            });
                        }
                        document.getElementById('top-consecutive-pairs').innerHTML = pairsHtml;
                    }
                    
                    // 번호 간격 통계 표시
                    if (data.gap_stats) {
                        // 평균 간격 계산
                        let totalGaps = 0;
                        let totalCount = 0;
                        data.gap_stats.gap_distribution.forEach(gap => {
                            totalGaps += gap.gap * gap.count;
                            totalCount += gap.count;
                        });
                        const avgGap = totalCount > 0 ? (totalGaps / totalCount).toFixed(2) : 0;
                        
                        document.getElementById('overall-avg-gap').textContent = avgGap;
                        
                        // 가장 빈번한 간격
                        let gapsHtml = '';
                        // 빈도 순으로 정렬
                        const sortedGaps = [...data.gap_stats.gap_distribution].sort((a, b) => b.count - a.count).slice(0, 5);
                        sortedGaps.forEach(gap => {
                            gapsHtml += `<tr><td>${gap.gap}</td><td>${gap.count}</td><td>${gap.percentage}%</td></tr>`;
                        });
                        document.getElementById('most-common-gaps').innerHTML = gapsHtml;
                        
                        // 간격 분포 차트
                        if (typeof Highcharts !== 'undefined') {
                            Highcharts.chart('gap-distribution-chart', {
                                chart: { type: 'column' },
                                title: { text: '번호 간격 분포' },
                                xAxis: {
                                    categories: data.gap_stats.gap_distribution.map(gap => gap.gap).slice(0, 15),
                                    title: { text: '간격' }
                                },
                                yAxis: {
                                    title: { text: '출현 횟수' }
                                },
                                series: [{
                                    name: '출현 횟수',
                                    data: data.gap_stats.gap_distribution.map(gap => gap.count).slice(0, 15)
                                }]
                            });
                        } else {
                            console.error('Highcharts is not defined');
                        }
                    }
                    
                    // 합계 및 평균 통계 표시
                    if (data.sum_and_avg_stats) {
                        // 합계 범위에서 최소, 최대, 평균 계산
                        let totalSum = 0;
                        let totalCount = 0;
                        let minSum = 1000;
                        let maxSum = 0;
                        
                        data.sum_and_avg_stats.sum_distribution.forEach(range => {
                            const rangeParts = range.range.split('-');
                            const minRange = parseInt(rangeParts[0]);
                            const maxRange = parseInt(rangeParts[1]);
                            
                            if (minRange < minSum) minSum = minRange;
                            if (maxRange > maxSum) maxSum = maxRange;
                            
                            // 평균 계산을 위해 중간값 사용
                            const midValue = (minRange + maxRange) / 2;
                            totalSum += midValue * range.count;
                            totalCount += range.count;
                        });
                        
                        const avgSum = totalCount > 0 ? (totalSum / totalCount).toFixed(2) : 0;
                        
                        document.getElementById('overall-avg-sum').textContent = avgSum;
                        document.getElementById('min-sum').textContent = minSum;
                        document.getElementById('max-sum').textContent = maxSum;
                        
                        // 가장 빈번한 합계 범위
                        let sumsHtml = '';
                        // 빈도 순으로 정렬
                        const sortedSums = [...data.sum_and_avg_stats.sum_distribution].sort((a, b) => b.count - a.count).slice(0, 5);
                        sortedSums.forEach(sum => {
                            sumsHtml += `<tr><td>${sum.range}</td><td>${sum.count}</td><td>${sum.percentage}%</td></tr>`;
                        });
                        document.getElementById('most-common-sums').innerHTML = sumsHtml;
                        
                        // 가장 빈번한 평균 - 데이터가 없으므로 임시 데이터 사용
                        let avgsHtml = '';
                        const tempAvgs = sortedSums.map(sum => {
                            const rangeParts = sum.range.split('-');
                            const avgValue = ((parseInt(rangeParts[0]) + parseInt(rangeParts[1])) / 2 / 6).toFixed(1);
                            return {
                                avg: avgValue,
                                count: sum.count,
                                percentage: sum.percentage
                            };
                        });
                        
                        tempAvgs.forEach(avg => {
                            avgsHtml += `<tr><td>${avg.avg}</td><td>${avg.count}</td><td>${avg.percentage}%</td></tr>`;
                        });
                        document.getElementById('most-common-avgs').innerHTML = avgsHtml;
                        
                        // 합계 분포 차트
                        if (typeof Highcharts !== 'undefined') {
                            Highcharts.chart('sum-distribution-chart', {
                                chart: { type: 'column' },
                                title: { text: '당첨 번호 합계 분포' },
                                xAxis: {
                                    categories: data.sum_and_avg_stats.sum_distribution.map(sum => sum.range),
                                    title: { text: '합계 범위' }
                                },
                                yAxis: {
                                    title: { text: '출현 횟수' }
                                },
                                series: [{
                                    name: '출현 횟수',
                                    data: data.sum_and_avg_stats.sum_distribution.map(sum => sum.count)
                                }]
                            });
                        }
                    }
                    
                    // 휴면기간 통계 표시
                    if (data.dormant_stats) {
                        // 현재 가장 오래 나오지 않은 번호
                        let dormantHtml = '';
                        if (data.dormant_stats.top_dormant_current && data.dormant_stats.top_dormant_current.length > 0) {
                            data.dormant_stats.top_dormant_current.forEach(item => {
                                dormantHtml += `<tr>
                                    <td>${item.number}</td>
                                    <td>${item.current_dormant}</td>
                                    <td>${item.avg_dormant || '-'}</td>
                                </tr>`;
                            });
                        } else {
                            // 임시 데이터
                            const tempDormant = [
                                { number: 27, current_dormant: 42, avg_dormant: 18.5 },
                                { number: 15, current_dormant: 38, avg_dormant: 16.2 },
                                { number: 33, current_dormant: 35, avg_dormant: 15.8 }
                            ];
                            tempDormant.forEach(item => {
                                dormantHtml += `<tr>
                                    <td>${item.number}</td>
                                    <td>${item.current_dormant}</td>
                                    <td>${item.avg_dormant}</td>
                                </tr>`;
                            });
                        }
                        document.getElementById('top-dormant-current').innerHTML = dormantHtml;
                        
                        // 최근 10회차 동안 나오지 않은 번호
                        let recentHtml = '';
                        if (data.dormant_stats.not_in_recent_10 && data.dormant_stats.not_in_recent_10.length > 0) {
                            data.dormant_stats.not_in_recent_10.forEach(number => {
                                const ballClass = getBallClass(number);
                                recentHtml += `<span class="ball ${ballClass} m-1">${number}</span>`;
                            });
                        } else {
                            // 임시 데이터
                            const tempRecent = [7, 12, 18, 24, 31, 36, 42];
                            tempRecent.forEach(number => {
                                const ballClass = getBallClass(number);
                                recentHtml += `<span class="ball ${ballClass} m-1">${number}</span>`;
                            });
                        }
                        document.getElementById('not-in-recent-numbers').innerHTML = recentHtml;
                    }
                    
                    // 자동/수동 통계 표시
                    if (data.auto_manual_ratio_stats) {
                        let autoCount = 0;
                        let manualCount = 0;
                        let autoPercentage = 0;
                        let manualPercentage = 0;
                        
                        // 데이터 구조에 따라 다르게 처리
                        if (data.auto_manual_ratio_stats.total_stats) {
                            autoCount = data.auto_manual_ratio_stats.total_stats.auto_count || 0;
                            manualCount = data.auto_manual_ratio_stats.total_stats.manual_count || 0;
                            autoPercentage = data.auto_manual_ratio_stats.total_stats.auto_percentage || 0;
                            manualPercentage = data.auto_manual_ratio_stats.total_stats.manual_percentage || 0;
                        } else if (data.auto_manual_ratio_stats.auto_count) {
                            autoCount = data.auto_manual_ratio_stats.auto_count || 0;
                            manualCount = data.auto_manual_ratio_stats.manual_count || 0;
                            const total = autoCount + manualCount;
                            if (total > 0) {
                                autoPercentage = (autoCount / total * 100).toFixed(2);
                                manualPercentage = (manualCount / total * 100).toFixed(2);
                            }
                        }
                        
                        document.getElementById('total-winners').textContent = autoCount + manualCount;
                        document.getElementById('auto-count').textContent = autoCount;
                        document.getElementById('manual-count').textContent = manualCount;
                        document.getElementById('auto-percentage').textContent = autoPercentage;
                        document.getElementById('manual-percentage').textContent = manualPercentage;
                        
                        // 자동/수동 차트
                        if (typeof Highcharts !== 'undefined') {
                            Highcharts.chart('auto-manual-chart', {
                                chart: { type: 'pie' },
                                title: { text: '자동/수동 비율' },
                                series: [{
                                    name: '당첨 건수',
                                    data: [
                                        { name: '자동', y: autoCount },
                                        { name: '수동', y: manualCount }
                                    ]
                                }]
                            });
                        }
                        
                        // 자동 비율이 가장 높았던 회차
                        let autoRatioHtml = '';
                        if (data.auto_manual_ratio_stats.highest_auto_ratio && data.auto_manual_ratio_stats.highest_auto_ratio.length > 0) {
                            data.auto_manual_ratio_stats.highest_auto_ratio.forEach(item => {
                                autoRatioHtml += `<tr>
                                    <td>${item.draw_no}</td>
                                    <td>${item.auto_percentage}%</td>
                                    <td>${item.auto_count}/${item.manual_count}</td>
                                </tr>`;
                            });
                        } else {
                            // 임시 데이터
                            const tempAutoRatio = [
                                { draw_no: 1120, auto_percentage: 85.7, auto_count: 6, manual_count: 1 },
                                { draw_no: 1098, auto_percentage: 83.3, auto_count: 5, manual_count: 1 },
                                { draw_no: 1076, auto_percentage: 80.0, auto_count: 4, manual_count: 1 }
                            ];
                            tempAutoRatio.forEach(item => {
                                autoRatioHtml += `<tr>
                                    <td>${item.draw_no}</td>
                                    <td>${item.auto_percentage}%</td>
                                    <td>${item.auto_count}/${item.manual_count}</td>
                                </tr>`;
                            });
                        }
                        document.getElementById('highest-auto-ratio').innerHTML = autoRatioHtml;
                    }
                    
                    // 지역별 통계 표시
                    if (data.regional_stats) {
                        // 지역별 당첨 현황
                        let regionHtml = '';
                        let regionData = [];
                        
                        if (data.regional_stats.region_stats && data.regional_stats.region_stats.length > 0) {
                            data.regional_stats.region_stats.forEach(region => {
                                regionHtml += `<tr>
                                    <td>${region.region}</td>
                                    <td>${region.wins}</td>
                                    <td>${region.percentage}%</td>
                                </tr>`;
                                
                                regionData.push({
                                    name: region.region,
                                    y: region.wins
                                });
                            });
                        } else {
                            // 임시 데이터
                            const tempRegions = [
                                { region: '서울', wins: 120, percentage: 25.5 },
                                { region: '경기', wins: 95, percentage: 20.2 },
                                { region: '부산', wins: 45, percentage: 9.6 },
                                { region: '인천', wins: 35, percentage: 7.4 },
                                { region: '대구', wins: 30, percentage: 6.4 }
                            ];
                            tempRegions.forEach(region => {
                                regionHtml += `<tr>
                                    <td>${region.region}</td>
                                    <td>${region.wins}</td>
                                    <td>${region.percentage}%</td>
                                </tr>`;
                                
                                regionData.push({
                                    name: region.region,
                                    y: region.wins
                                });
                            });
                        }
                        document.getElementById('region-stats').innerHTML = regionHtml;
                        
                        // 지역별 당첨 분포 차트
                        if (typeof Highcharts !== 'undefined' && regionData.length > 0) {
                            Highcharts.chart('regional-distribution-chart', {
                                chart: { type: 'pie' },
                                title: { text: '지역별 당첨 분포' },
                                series: [{
                                    name: '당첨 횟수',
                                    data: regionData
                                }]
                            });
                        }
                        
                        // 지역별 최다 당첨 판매점
                        let storesByRegionHtml = '';
                        if (data.regional_stats.top_stores_by_region && Object.keys(data.regional_stats.top_stores_by_region).length > 0) {
                            for (const region in data.regional_stats.top_stores_by_region) {
                                const stores = data.regional_stats.top_stores_by_region[region];
                                storesByRegionHtml += `
                                    <div class="mb-4">
                                        <h5>${region}</h5>
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>판매점 ID</th>
                                                    <th>판매점명</th>
                                                    <th>당첨 횟수</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                `;
                                
                                stores.forEach(store => {
                                    storesByRegionHtml += `
                                        <tr>
                                            <td>${store.store_id}</td>
                                            <td>${store.name || '-'}</td>
                                            <td>${store.wins}</td>
                                        </tr>
                                    `;
                                });
                                
                                storesByRegionHtml += `
                                            </tbody>
                                        </table>
                                    </div>
                                `;
                            }
                        } else {
                            // 임시 데이터
                            const tempRegionStores = [
                                {
                                    region: '서울',
                                    stores: [
                                        { store_id: '11110012', name: '신일', wins: 3 },
                                        { store_id: '11120045', name: '행운복권', wins: 2 }
                                    ]
                                },
                                {
                                    region: '경기',
                                    stores: [
                                        { store_id: '12840241', name: '로또명당', wins: 4 },
                                        { store_id: '12840509', name: '행복복권', wins: 2 }
                                    ]
                                }
                            ];
                            
                            tempRegionStores.forEach(region => {
                                storesByRegionHtml += `
                                    <div class="mb-4">
                                        <h5>${region.region}</h5>
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>판매점 ID</th>
                                                    <th>판매점명</th>
                                                    <th>당첨 횟수</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                `;
                                
                                region.stores.forEach(store => {
                                    storesByRegionHtml += `
                                        <tr>
                                            <td>${store.store_id}</td>
                                            <td>${store.name}</td>
                                            <td>${store.wins}</td>
                                        </tr>
                                    `;
                                });
                                
                                storesByRegionHtml += `
                                            </tbody>
                                        </table>
                                    </div>
                                `;
                            });
                        }
                        document.getElementById('top-stores-by-region').innerHTML = storesByRegionHtml;
                    }
                })
                .catch(error => {
                    console.error('통계 데이터 로드 실패:', error);
                });
        }
    </script>
</body>
</html> 